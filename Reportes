// Obtener asig_numero desde inv_inf_inv usando la referencia
const resultadoAsig = await this.prismaNovasoftService.$queryRawUnsafe<any[]>(`
  SELECT TOP 1 asig_numero
  FROM inv_inf_inv
  WHERE obs_orc LIKE '%' + '${referencia}' + '%'
`);

if (!resultadoAsig || resultadoAsig.length === 0) {
  throw new Error(`No se encontró asig_numero para la referencia ${referencia}`);
}

const asigNumero = resultadoAsig[0].asig_numero;

// Determinar cod_sub según el prefijo de asig_numero
let cod_sub = '';
if (asigNumero.startsWith('OS') || asigNumero.startsWith('OC')) {
  cod_sub = 'C008';
} else if (asigNumero.startsWith('PF')) {
  cod_sub = 'PFIN';
} else if (asigNumero.startsWith('CN')) {
  cod_sub = 'NCIN';
} else {
  throw new Error(`No se pudo determinar el sub_tip para asig_numero ${asigNumero}`);
}

console.log('AsigNumero:', asigNumero, 'CodSub:', cod_sub);