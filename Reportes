USE [Novasoft]
GO
/****** Object:  StoredProcedure [dbo].[usr_sp_pre_modifica_cdp]    Script Date: 3/12/2025 2:37:58 p. m. ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
ALTER PROCEDURE [dbo].[usr_sp_pre_modifica_cdp]
	@ano_cdp	CHAR(4),
	@num_cdp	CHAR(14),
	@valor		MONEY,
	@estado		SMALLINT
AS

SET NOCOUNT ON
SET ROWCOUNT 0


INSERT INTO pre_auditoria (cod_usuario,fecha,modulo,evento,descripcion,nom_maq) 
VALUES(Suser_Sname(),GETDATE(),'DOCUM','C',
RTRIM(@ano_cdp)+'-U726-'+RTRIM(@num_cdp)+'-MODIFICA VALOR Y ESTADO CDP',host_name())


UPDATE pre_cuedoc SET estado_cdp=@estado, valor_cdp=@valor WHERE ano_doc=@ano_cdp AND sub_tip='U726' AND num_doc=@num_cdp

IF @@ROWCOUNT>0
	SELECT 'OK' AS respuesta
ELSE 
	SELECT 'CDP NO EXISTE' AS respuesta
