//Validar que el item exista

const { item, cantidad, cos_uni, por_des, bodega, usr_descrip_cue, dia_pla } = Articulos[i];
console.log(usr_descrip_cue)
const usrDescripCueLimitado = usr_descrip_cue
? usr_descrip_cue.substring(0, 200)
: '';

const itemLimpio = item.trim().replace(/;/g, '');

// Validar info del item
const itemInfo = await this.prismaNovasoftService.$queryRawUnsafe<any[]>(`
    SELECT cod_est, cod_ret_com, por_ret, por_iva, por_iva_ng
    FROM inv_items
    WHERE cod_item = '${itemLimpio}'
`);

if (itemInfo.length === 0) {
    throw new BadRequestException(`El item ${itemLimpio} no existe`);
}

// VALIDAR SI EL ÍTEM ESTÁ ACTIVO (1 = activo, 0 = inactivo)
const estadoItem = itemInfo[0].cod_est;

if (estadoItem !== 1) {
    throw new BadRequestException(`El item ${itemLimpio} no está activo`);
}

const { cod_ret_com, por_ret, por_iva, por_iva_ng } = itemInfo[0];
const cod_ret = `${cod_ret_com}`;